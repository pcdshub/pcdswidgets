<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding a New Vacuum Widget &mdash; PCDSWidgets 0.7.2.dev43+g5469691 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Configuring the Development Environment" href="dev.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PCDSWidgets
          </a>
              <div class="version">
                0.7.2.dev43+g5469691
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Widgets</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="vacuum.html">Vacuum Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="icons.html">Symbol Icons</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mixins.html">Mixins</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dev.html">Configuring the Development Environment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding a New Vacuum Widget</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation-overview">Implementation Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-icon-widget">Adding a New Icon Widget</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-widget-class">Adding a New Widget Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-your-widget-to-the-designer">Adding your Widget to the Designer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stylesheets">Stylesheets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-expert-screen">The Expert Screen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Related Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/slaclab/pydm">PyDM</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pcdshub/pcdswidgets">PCDSWidgets GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pcdshub">PCDS-wide GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PCDSWidgets</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Adding a New Vacuum Widget</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/addwidget.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-a-new-vacuum-widget">
<h1>Adding a New Vacuum Widget<a class="headerlink" href="#adding-a-new-vacuum-widget" title="Permalink to this heading"></a></h1>
<p>This page details the development process for adding a new vacuum widget.
It was made during the process of creating the PneumaticValveDA widget.</p>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>You should have the following things in mind before you begin:</p>
<ul class="simple">
<li><p>What should the widget look like?</p></li>
<li><p>Is there any existing widget that this is similar to?</p></li>
<li><p>What are my interlock, error, state readback, and control PVs?</p></li>
</ul>
</section>
<section id="implementation-overview">
<h2>Implementation Overview<a class="headerlink" href="#implementation-overview" title="Permalink to this heading"></a></h2>
<p>You’ll need to do the following things:</p>
<ul class="simple">
<li><p>Add a new icon widget.</p></li>
<li><p>Add a new valve widget that uses the icon.</p></li>
<li><p>Add your new widget to the designer.</p></li>
<li><p>Update stylesheets to be consistent for your new widget.</p></li>
<li><p>Add a new device class for your widget’s expert screen.</p></li>
</ul>
</section>
<section id="adding-a-new-icon-widget">
<h2>Adding a New Icon Widget<a class="headerlink" href="#adding-a-new-icon-widget" title="Permalink to this heading"></a></h2>
<p>The icon widgets are stored in pcdswidgets/icons and are implemented by
using the QtGui painter tools. I suggest you pick a class that almost
does what you want as a starting point.
With BaseSignalIcon as a parent class, the only method you need to override
is “draw_icon”. Check out the other icons for examples and feel free to
browse the qt documentation.
This process will take a lot of iterations
(edit the file, check the ui, repeat).
To make this process smoother, I added a script embedded in the icons module.
Try this to open an application that simply displays a widget:</p>
<p>Some tips:</p>
<ul class="simple">
<li><p>The coordinate system starts from the top left of the icon, so positive y is down</p></li>
<li><p>The expected size of the widget icon is from 0 to 1 in both x and y</p></li>
<li><p>If you want something to be modifyable via stylesheet, PV, etc., you can make it
a property with qt’s &#64;Property flag. This is useful for alarm sensitive coloring,
for example.</p></li>
<li><p>When drawing a shape, it’s useful to parameterize it even if you only use it once.
This is because you may later want to edit the specifics, but if your QPolygon
is just a list of numbers this will be very hard. A list of variables like
“arrow_length” are easier to modify later.</p></li>
<li><p>When designing your shape, note that the widget might need to look good at
different sizes. Pay particular care in designing widget icons with small features,
these can become indistiguishable as we shrink the shapes down.</p></li>
</ul>
</section>
<section id="adding-a-new-widget-class">
<h2>Adding a New Widget Class<a class="headerlink" href="#adding-a-new-widget-class" title="Permalink to this heading"></a></h2>
<p>Widget classes in pcdswidgets are constructed from a network of mix-ins and parent
classes. A good place to start is simply copying the most similar existing
widget and modifying the specifics to match yours. Barring something extremely
similar existing, you’ll need to delve into the specifics of the inner workings
and I can’t encapsulate that in a guide.</p>
<p>In some cases, you may be able to get away with simply copying a widget
and changing the docstrings, attributes, and super calls as appropriate.</p>
<p>For deeper dives, I recommend looking at each mix-in class in isolation to
understand how that particular feature is implemented.</p>
<p>You can test your new widget quickly by running the helper script:</p>
<p>But you should make some screens with it to explore the finer details.</p>
</section>
<section id="adding-your-widget-to-the-designer">
<h2>Adding your Widget to the Designer<a class="headerlink" href="#adding-your-widget-to-the-designer" title="Permalink to this heading"></a></h2>
<p>This is probably the easiest step of the process. Simply import your new widget
in designer.py and add an appriopriate entry using the qtplugin_factory.</p>
<p>To check that this worked, you can simply open designer. You should see
your widget added to the list.</p>
</section>
<section id="stylesheets">
<h2>Stylesheets<a class="headerlink" href="#stylesheets" title="Permalink to this heading"></a></h2>
<p>For the widget to properly display its state, it needs an entry in the stylesheet.
For widgets that are exceedingly simple to existing widgets, this might just
involve copying and pasting existing entries in the stylesheet, and editing the
copy to refer to your new widget. This is appropriate for adding a new valve type
for example.</p>
<p>In other cases, you’ll need to do involved testing to figure out what stylesheet
gives the look and feel you want for the widget, and make sure this ends up in
the master stylesheet.</p>
<p>The master stylesheet is held in the vacuumscreens repo. If it has not moved,
it can be viewed at
<a class="reference external" href="https://github.com/pcdshub/vacuumscreens/blob/master/styleSheet/masterStyleSheet.qss">https://github.com/pcdshub/vacuumscreens/blob/master/styleSheet/masterStyleSheet.qss</a></p>
<p>To activate this stylesheet for dev use, you need to set your
PYDM_STYLESHEET environment variable appropriately, e.g.</p>
<p>Make sure to open a pull request with your updated stylesheet in that repo and make
sure that your edits get deployed in dev/prod.</p>
</section>
<section id="the-expert-screen">
<h2>The Expert Screen<a class="headerlink" href="#the-expert-screen" title="Permalink to this heading"></a></h2>
<p>We typically build our expert screens out of ophyd objects using the typhos module.
All the specifics of this are out of scope for this tutorial, but check out
pcdsdevices for our main repository of device definitions.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading"></a></h2>
<p>It is important to document your new widget.
See examples throughout the documentation here.</p>
<p>There are three places to update:</p>
<ul class="simple">
<li><p>In the vacuum subfolder, find the relevant file and add your widget
to the most logical section</p></li>
<li><p>In icons.rst, extend the two reference areas with a line for the table
and the class-matching icon png name. The icon pngs are created
automatically, so make sure your icon is importable from the top-level
pcdswidgets.icons and is included in the __all__ tuple there.</p></li>
<li><p>Write detailed docstrings in the new classes you have added
(both the icon and widget).</p></li>
</ul>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this heading"></a></h2>
<p>Your widget will automatically be tested if imported in the __all__ tuple
of the vacuum submodule. Make sure to import your new widget in __init__.py
there and include it in the __all__ tuple.</p>
<p>This will catch basic issues only.</p>
<p>You should also test your widget on real devices to make sure the behavior is
correct.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dev.html" class="btn btn-neutral float-left" title="Configuring the Development Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, SLAC National Accelerator Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>